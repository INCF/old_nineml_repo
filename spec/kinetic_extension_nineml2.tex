\documentclass[draftspec]{ninemlspec}
\usepackage{microtype}
\usepackage{pbox}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{float}
%% ============================================================================
%% Description:  Documentation for \lq\lq{}The NineML Specification Document\rq\rq{}
%% Authors: Thomas G. Close <tclose@oist.jp>, Ivan Raikov <raikov@oist.jp>, Andrew P. Davison <davison@unic.cnrs-gif.fr>
%% Organization: Okinawa Institute of Science and Technology Graduate University, Centre National de la Recherche Scientifique
%% Date created: October 2014  <---- should probably be some date in 2010, 2011 or so...
%% https://github.com/INCF/nineml/master/spec/specification.tex
%%
%% Copyright (C) 2014 Okinawa Institute of Science and Technology Graduate University, Centre National de la Recherche Scientifique
%%
%% ============================================================================

\newcommand{\incomplete}{\begin{center}\noindent{\Large\textcolor{incompletered}{\textbf{!! INCOMPLETE !!}}}\end{center}}

% Define misc. references
\newcommand{\identifier}{\typeDefRef{identifier\xspace}{sec:identifier}}
\newcommand{\URL}{\href{http://en.wikipedia.org/wiki/Uniform_resource_locator}{URL}\xspace}
\newcommand{\MathML}{\href{http://mathml.org}{MathML (http://mathml.org)}\xspace}

% Define Abstraction Layer element references

\newcommand{\Unit}{\defRef{\textbf{\class{Unit}}\xspace}{sec:Unit}}
\newcommand{\Dimension}{\defRef{\textbf{\class{Dimension}}\xspace}{sec:Dimension}}
\newcommand{\ComponentClass}{\defRef{\textbf{\class{ComponentClass}}\xspace}{sec:ComponentClass}}
\newcommand{\Dynamics}{\defRef{\defRef{\textbf{\class{Dynamics}}\xspace}{sec:Dynamics}}{sec:Dynamics}}
\newcommand{\Function}{\defRef{\textbf{\class{Function}}\xspace}{sec:Function}}
\newcommand{\BuiltInDistribution}{\defRef{\textbf{\class{BuiltInDistribution}}\xspace}{sec:BuiltInDistribution}}
\newcommand{\ConnectionRule}{\defRef{\textbf{\class{ConnectionRule}}\xspace}{sec:ConnectionRule}}
\newcommand{\ConnectCondition}{\defRef{\textbf{\class{ConnectCondition}}\xspace}{sec:ConnectCondition}}
\newcommand{\ExplicitConnections}{\defRef{\textbf{\class{ExplicitConnections}}\xspace}{sec:ExplicitConnections}}
\newcommand{\SourceIndices}{\defRef{\textbf{\class{SourceIndices}}\xspace}{sec:SourceIndices}}
\newcommand{\DestinationIndices}{\defRef{\textbf{\class{DestinationIndices}}\xspace}{sec:DestinationIndices}}
\newcommand{\SelectConnections}{\defRef{\textbf{\class{SelectConnections}}\xspace}{sec:SelectConnections}}
\newcommand{\Number}{\defRef{\textbf{\class{Number}}\xspace}{sec:Number}}
\newcommand{\Preference}{\defRef{\textbf{\class{Preference}}\xspace}{sec:Preference}}
\newcommand{\MathInline}{\defRef{\textbf{\class{MathInline}}\xspace}{sec:MathInline}}
\newcommand{\Piecewise}{\defRef{\textbf{\class{Piecewise}}\xspace}{sec:Piecewise}}
\newcommand{\Piece}{\defRef{\textbf{\class{Piece}}\xspace}{sec:Piece}}
\newcommand{\Expression}{\defRef{\textbf{\class{Expression}}\xspace}{sec:Expression}}
\newcommand{\Condition}{\defRef{\textbf{\class{Condition}}\xspace}{sec:Condition}}
\newcommand{\Otherwise}{\defRef{\textbf{\class{Otherwise}}\xspace}{sec:Otherwise}}
\newcommand{\KineticState}{\defRef{\textbf{\class{KineticState}}\xspace}{sec:KineticState}}
\newcommand{\StateAssignment}{\defRef{\textbf{\class{StateAssignment}}\xspace}{sec:StateAssignment}}
\newcommand{\TimeDerivative}{\defRef{\textbf{\class{TimeDerivative}}\xspace}{sec:TimeDerivative}}
\newcommand{\Alias}{\defRef{\textbf{\class{Alias}}\xspace}{sec:Alias}}
\newcommand{\Constant}{\defRef{\textbf{\class{Constant}}\xspace}{sec:Constant}}
\newcommand{\RandomVariable}{\defRef{\textbf{\class{RandomVariable}}\xspace}{sec:RandomVariable}}
\newcommand{\Argument}{\defRef{\textbf{\class{Argument}}\xspace}{sec:Argument}}
\newcommand{\StandardLibrary}{\defRef{\textbf{\class{StandardLibrary}}\xspace}{sec:StandardLibrary}}
\newcommand{\Regime}{\defRef{\textbf{\class{Regime}}\xspace}{sec:Regime}}
\newcommand{\Trigger}{\defRef{\textbf{\class{Trigger}}\xspace}{sec:Trigger}}
\newcommand{\EventOut}{\defRef{\textbf{\class{EventOut}}\xspace}{sec:EventOut}}
\newcommand{\OnEvent}{\defRef{\textbf{\class{OnEvent}}\xspace}{sec:OnEvent}}
\newcommand{\OnCondition}{\defRef{\textbf{\class{OnCondition}}\xspace}{sec:OnCondition}}
\newcommand{\Parameter}{\defRef{\textbf{\class{Parameter}}\xspace}{sec:Parameter}}
\newcommand{\AnalogSendPort}{\defRef{\textbf{\class{AnalogSendPort}}\xspace}{sec:AnalogSendPort}}


\newcommand{\EventSendPort}{\defRef{\textbf{\class{EventSendPort}}\xspace}{sec:EventSendPort}}
\newcommand{\AnalogReceivePort}{\defRef{\textbf{\class{AnalogReceivePort}}\xspace}{sec:AnalogReceivePort}}
\newcommand{\AnalogReducePort}{\defRef{\textbf{\class{AnalogReducePort}}\xspace}{sec:AnalogReducePort}}
\newcommand{\AnalogArrayPort}{\defRef{\textbf{\class{AnalogArrayPort}}\xspace}{sec:AnalogArrayPort}}
\newcommand{\EventReceivePort}{\defRef{\textbf{\class{EventReceivePort}}\xspace}{sec:EventReceivePort}}
\newcommand{\PropertySendPort}{\defRef{\textbf{\class{PropertySendPort}}\xspace}{sec:PropertySendPort}}
\newcommand{\PropertyReceivePort}{\defRef{\textbf{\class{PropertyReceivePort}}\xspace}{sec:PropertyReceivePort}}
\newcommand{\IndexSendPort}{\defRef{\textbf{\class{IndexSendPort}}\xspace}{sec:IndexSendPort}}
\newcommand{\IndexReceivePort}{\defRef{\textbf{\class{IndexReceivePort}}\xspace}{sec:IndexReceivePort}}
\newcommand{\Annotations}{\defRef{\textbf{\class{Annotations}}\xspace}{sec:Annotations}}

% Define User Layer element references

\newcommand{\Component}{\defRef{\textbf{\class{Component}}\xspace}{sec:Component}}
\newcommand{\Property}{\defRef{\textbf{\class{Property}}\xspace}{sec:Property}}
\newcommand{\DerivedProperty}{\defRef{\textbf{\class{DerivedProperty}}\xspace}{sec:DerivedProperty}}
\newcommand{\Quantity}{\defRef{\textbf{\class{Quantity}}\xspace}{sec:Quantity}}
\newcommand{\SingleValue}{\defRef{\textbf{\class{SingleValue}}\xspace}{sec:SingleValue}}
\newcommand{\ExternalArrayValue}{\defRef{\textbf{\class{ExternalArrayValue}}\xspace}{sec:ExternalArrayValue}}
\newcommand{\FromFunction}{\defRef{\textbf{\class{FromFunction}}\xspace}{sec:FromFunction}}
\newcommand{\ArrayValue}{\defRef{\textbf{\class{ArrayValue}}\xspace}{sec:ArrayValue}}
\newcommand{\ArrayValueRow}{\defRef{\textbf{\class{ArrayValueRow}}\xspace}{sec:ArrayValueRow}}
\newcommand{\ListColumn}{\defRef{\textbf{\class{ListColumn}}\xspace}{sec:ListColumn}}
\newcommand{\Definition}{\defRef{\textbf{\class{Definition}}\xspace}{sec:Definition}}
\newcommand{\Prototype}{\defRef{\textbf{\class{Prototype}}\xspace}{sec:Prototype}}
\newcommand{\Reference}{\defRef{\textbf{\class{Reference}}\xspace}{sec:Reference}}
\newcommand{\Constraint}{\defRef{\textbf{\class{Constraint}}\xspace}{sec:Constraint}}
\newcommand{\Cell}{\defRef{\textbf{\class{Cell}}\xspace}{sec:Cell}}
\newcommand{\Size}{\defRef{\textbf{\class{Size}}\xspace}{sec:Size}}
\newcommand{\AdditionalProperty}{\defRef{\textbf{\class{AdditionalProperty}}\xspace}{sec:AdditionalProperty}}
\newcommand{\Reaction}{\defRef{\textbf{\class{Reaction}}\xspace}{sec:Reaction}}
\newcommand{\Source}{\defRef{\textbf{\class{Source}}\xspace}{sec:Source}}
\newcommand{\Destination}{\defRef{\textbf{\class{Destination}}\xspace}{sec:Destination}}
\newcommand{\Connectivity}{\defRef{\textbf{\class{Connectivity}}\xspace}{sec:Connectivity}}
\newcommand{\Synapse}{\defRef{\textbf{\class{Synapse}}\xspace}{sec:Synapse}}
\newcommand{\Delay}{\defRef{\textbf{\class{Delay}}\xspace}{sec:Delay}}
\newcommand{\FromSource}{\defRef{\textbf{\class{FromSource}}\xspace}{sec:FromSource}}
\newcommand{\FromDestination}{\defRef{\textbf{\class{FromDestination}}\xspace}{sec:FromDestination}}
\newcommand{\FromSynapse}{\defRef{\textbf{\class{FromSynapse}}\xspace}{sec:FromSynapse}}
\newcommand{\FromIndex}{\defRef{\textbf{\class{FromIndex}}\xspace}{sec:FromIndex}}
\newcommand{\FromCellProperty}{\defRef{\textbf{\class{FromCellProperty}}\xspace}{sec:FromCellProperty}}
\newcommand{\FromAdditionalProperty}{\defRef{\textbf{\class{FromAdditionalProperty}}\xspace}{sec:FromAdditionalProperty}}
\newcommand{\Network}{\defRef{\textbf{\class{Network}}\xspace}{sec:Network}}
\newcommand{\Member}{\defRef{\textbf{\class{Member}}\xspace}{sec:Member}}
\newcommand{\Selection}{\defRef{\textbf{\class{Selection}}\xspace}{sec:Selection}}
\newcommand{\Concatenate}{\defRef{\textbf{\class{Concatenate}}\xspace}{sec:Concatenate}}
\newcommand{\Item}{\defRef{\textbf{\class{Item}}\xspace}{sec:Item}}

% Multi-component element references
\newcommand{\MultiComponentClass}{\defRef{\textbf{\class{MultiComponentClass}}\xspace}{sec:MultiComponentClass}}
\newcommand{\SubComponent}{\defRef{\textbf{\class{SubComponent}}\xspace}{sec:SubComponent}}
\newcommand{\PortExposure}{\defRef{\textbf{\class{PortExposure}}\xspace}{sec:PortExposure}}
\newcommand{\MetaParameter}{\defRef{\textbf{\class{MetaParameter}}\xspace}{sec:MetaParameter}}
\newcommand{\ReceiveConnection}{\defRef{\textbf{\class{ReceiveConnection}}\xspace}{sec:ReceiveConnection}}
\newcommand{\FromSister}{\defRef{\textbf{\class{FromSister}}\xspace}{sec:FromSister}}
\newcommand{\FromDomainID}{\defRef{\textbf{\class{FromDomainID}}\xspace}{sec:FromDomainID}}
\newcommand{\MultiComponent}{\defRef{\textbf{\class{MultiComponent}}\xspace}{sec:MultiComponent}}

% Multi-compartment element references

\newcommand{\MultiCompartmentClass}{\defRef{\textbf{\class{MultiCompartmentClass}}\xspace}{sec:MultiCompartmentClass}}
\newcommand{\MultiPortExposure}{\defRef{\textbf{\class{MultiPortExposure}}\xspace}{sec:MultiPortExposure}}
\newcommand{\Branches}{\defRef{\textbf{\class{Branches}}\xspace}{sec:Branches}}
\newcommand{\Mapping}{\defRef{\textbf{\class{Mapping}}\xspace}{sec:Mapping}}
\newcommand{\DomainClass}{\defRef{\textbf{\class{DomainClass}}\xspace}{sec:DomainClass}}
\newcommand{\Domain}{\defRef{\textbf{\class{Domain}}\xspace}{sec:Domain}}
\newcommand{\FromProximal}{\defRef{\textbf{\class{FromProximal}}\xspace}{sec:FromProximal}}
\newcommand{\FromDistal}{\defRef{\textbf{\class{FromDistal}}\xspace}{sec:FromDistal}}
\newcommand{\MultiCompartmental}{\defRef{\textbf{\class{MultiCompartmental}}\xspace}{sec:MultiCompartmental}}
\newcommand{\MultiCompartmentReaction}{\defRef{\textbf{\class{MultiCompartmentReaction}}\xspace}{sec:MultiCompartmentReaction}}
\newcommand{\CompartmentConnectivity}{\defRef{\textbf{\class{CompartmentConnectivity}}\xspace}{sec:CompartmentConnectivity}}

% Macros just for this document:

\newcommand{\ninemlpkg}{\texorpdfstring{%
    \textls[-25]{\textsc{NineMLSpec}}}{%
    \textsc{NineMLSpec}}\xspace}
\newcommand{\ninemlpkghead}{\texorpdfstring{%
    \textls[-50]{\textsc{NineMLSpec}}}{%
    \textsc{NineMLSpec}}\xspace}
\newcommand{\distURL}{https://github.com/INCF/nineml/tree/master/spec/specification.pdf}
\newcommand{\srcURL}{https://github.com/INCF/nineml/tree/master/spec/specification.tex}
\newcommand{\webURL}{https://github.com/INCF/nineml/tree/master/spec/specification.pdf}

\newcommand{\KineticEquation}{\defRef{\textbf{\class{KineticEquation}}\xspace}{sec:KineticEquation}}
\newcommand{\ForwardRate}{\defRef{\textbf{\class{ForwardRate}}\xspace}{sec:ForwardRate}}
\newcommand{\ReverseRate}{\defRef{\textbf{\class{ReverseRate}}\xspace}{sec:ReverseRate}}
\newcommand{\Conserve}{\defRef{\textbf{\class{Conserve}}\xspace}{sec:Conserve}}

% Custom latex listing style, for use with the listings package.  The default
% highlights far too many things, IMHO.  This keeps it simple and only adjusts
% the appearance of comments within listings.

\lstdefinelanguage{mylatex}{
  morekeywords={},%
  sensitive,%
  alsoother={0123456789$_},%$
  morecomment=[l]\%%
}[keywords,tex,comments]

\lstdefinestyle{latex}{language=mylatex}

% -----------------------------------------------------------------------------
% Start of document
% -----------------------------------------------------------------------------

\begin{document}

\packageTitle{Kinetic Extension to NineML (9ML) Specification}
\packageVersion{Version 2.0dev}
\packageVersionDate{ \today}

\pagestyle{empty}

\begin{center}
{\includegraphics[width=0.7\columnwidth]{figures/incf_new.png}}

\end{center}

\vspace*{0.5cm}

\noindent\rule{\columnwidth}{2pt}

\vspace*{0.75cm}

\begin{center}
\noindent{\Huge \bf NineML Kinetic Extension	}\\
\vspace{0.5cm}
\noindent{\LARGE \bf Specification}\\
\vspace{0.5cm}
\noindent{\large NineML Standardization Committee}\\
\vspace{0.5cm}
\noindent{\large Version: 2.0dev}
\end{center}

\vspace*{0.5cm}

\noindent\rule{\columnwidth}{2pt}

\vspace*{0.25cm}
\noindent{

{\Large\bf Editors: }
\begin{itemize}
\item Tom Close %probably the same whole list as NineML Spec?
\item Russell Jarvis
\end{itemize}

\vspace*{0.25cm}

\begin{normalsize}
\noindent \textbf{Acknowledgments:}\\\\
\noindent

\vspace*{0.5cm}

This document is under the Common Creative license BY-NC-SA:\\ http://creativecommons.org/licenses/by-nc-sa/3.0/

\vspace*{0.25cm}

{\flushright \includegraphics[width=3cm]{figures/by-nc-sa.png}}

\vspace*{0.5cm}

\noindent {\bf Date:} \today
\end{normalsize}
}

\title{Kinetic Extension to NineML Specification}

\newpage
\pagestyle{plain}

%\maketitlepage
%\maketableofcontents

% -----------------------------------------------------------------------------
\section{Introduction}

The purpose of NineML is to provide a simulator independent language for describing neuron relevant molecular, single cell, and neural network models. NineML is a declarative language which means that it is only necessary to describe the logic of the desired neural model, it is not necessary to provide implementation details. Because NineML provides a means to instantiate a model on any neural network simulator this will increase reproducibility of research.\\
\\
Because NEURON is a dominant simulator within the field of neuroscience NineML must be able to translate a complete model written in NMODL into an appropriate NineML format. NineML must also be able to translate appropriately formatted NineML model back to NMODL code. To successfully translate NMODL the KINETICs BLOCK of an NMODL mechanism must also be translated and it is this process that is described herein.

%insert paragraph 4 here.

%The Dynamics block represents the internal mechanisms governing the behaviour of the component. These
%dynamics are based on ordinary differential equations (ODE) but may contain non-linear transitions between
%different ODE regimes. The regime graph (e.g. Figure 2) must contain at least one Regime element, and contain
%no regime islands. At any given time, a component will be in a single regime, and can change which regime it is in
%through transitions.



% -----------------------------------------------------------------------------
%\vspace{-12.5pc} % A bit of a hack to reverse the vspace added by the Appendix name


\subsection{Scope}

The purpose of the kinetic extension to NINEML is to provide a convenient means of converting the KINETIC scheme block in a model described by NMODL to the NINEML language. The kinetic extension must also provided a means of converting from the NINEML language back into the KINETIC block scheme specified by NMODL. Ultimately the kinetic scheme should be able to handle discontinuous state transitions.

\begin{enumerate}
\item NMODL
%\item PARAMETER block
%\item STATE block
%\item DERIVATIVE block
\item KINETIC block
%\item NineML
\item KineticState
%\item TimeDerivative
%\item Translation
\end{enumerate}




\subsection{NMDOL}
NMODL provides a means of expanding the library of mechanisms available to NEURON simulator. The nervous system of any animal is typically made up of many species of neurons. Each species of neuron can be described by its own ionic and molecular properties. For example the concentration of Sodium ion channels may vary along the length of apical and distal dendrites. In the context of the NEURON simulator these ion channel and molecular properties are called mechanisms, and the NMODL language specifies a means to create new models of ionic and molecular mechanisms. By using a collection of compiled NMODL files the combined effects of many mechanisms can contribute to the resulting model output \cite{carnevale2006neuron}. 

\section{NMODL Blocks}

\subsection{PARAMETER block}

Parameters refer to variables that are supplied by the user of the model. These values often refer to physical properties of neural tissue and often remain constant during the simulation.  By declaring a variable in PARAMETER block, you give that variable local scope, meaning that each instance of a mechanism is allowed to have its own varying values across spatially separated mechanisms. The values declared here are most often emperically derived default values, or initial conditions.
%PARAMETERs values are visible to HOC interpreter.
%variables who values are normally specified by the user are parameters, and are declared in a PARAMETER block. PARAMETERS generally remain constant during a simulation, but they can be changed in mid-run if necssary to emulate some external influence on the characteristic properties of a model.

\subsection{STATE block}

When a model invokes kinetic reaction schemes the unknown (dependent) variables belonging to the reaction scheme must be declared in the state block, this can include gating variables.

In NMODL a {\it range variable} is a variable whose value is allowed to vary as a function of distance. This is in contrast to a {\it point process} whose values are only defined in a discrete point in space. All state variables are range variables in NEURON.  

Typical state variables in a kinetic scheme are: closed, open and inactive states, these are denoted c, o, i respectively. The fraction of ion channels that are closed, open and inactive are all solved by differential equations. In the context of Kinetic schemes STATE variables will often follow a conservation rule, where the fraction of all possible open and closed states must equal one.


\subsection{PROCEDURE block}
The rate of change at which state variables can move between states is critical to the function of a kinetic scheme model. The function which describes rates is usually different for states that are changing in different directions for instance the function that describes moving from open to closed is different from the function that describes moving from closed to open.

%Rates are often asymmetrical so that the rate at which a channel moves from open to closed may be different to the function that  than the rate at which a channel move from closed to open. 

The procedure block provides an opportunity to define a procedure called { \it rates()}  which will allow us to state equations that determine the rate based on supplied PARAMETERS. The { \it rates()} procedure returns equilibrium constants.

% If there are N state variables. Because of the conservation rule, there is always N-1 indipendent states. The Nth state is dependent and is implied by the conservation of states rule. The NINEML algotihm exploits this property in calculating states.

\subsection{DERIVATIVE block}


\subsection{KINETIC block}

The NMODL translator converts the content of the kinetic scheme block into a family of Ordinary Differential Equations. An equivalent but less readable method of doing this would be to declare the appropriate differential equations to be solved in a NEURON DERIVATIVE block\cite{carnevale2006neuron}

The concept of conservation of matter is central in calculating the fraction of ion channels that occupy a particular state. This is because ion transition from one state equals ion transition into another state.

The kinetics block can call a procedure such as { \it rates()}
The rates function solves the equilibrium constants, using time constants which may have been derived theoretically.


%Unknown variables which are solved 


%Direct qoute from the NEURON book:
\begin{lstlisting}[language=c]

STATE { mc m }
KINETIC scheme1 {
	~ mc <-> m (a(v), b(v))
}
is equivalent to 

DERIVATIVE scheme1{
	mc' = -a(v)*mc + b(v)*m
	m'  =  a(v)*mc - b(v)*m

}

\end{lstlisting}
%Paraphrased:
The two expressions in paranthesis a(v), and b(v) indicate the forward and reverse reaction rates. And variables directly adjacent to the tokens: $<->$ signify the reactants. Kinetic schemes use a basic notation where the tilde ~ signifies to the NMODL compiler that this is a Kinetic scheme. 


% The voltage dependent rate constants are computed in produre rates(). That procedure computes the equilibrium constants K1 and K2 from the constants k1, d1, k2, and d2, whose emperically determined default values are given in the PARAMETER 
% block, and membrane potential v. The time constants tau1 and tau2, however are found from tables created under hoc.
%
%

\subsection{DERIVATIVE block}

\subsection{BREAKPOINT}
In the NEURON book \cite{carnevale2006neuron} it is recommended that sparse METHOD should be used for SOLVE a kinetic scheme. This is specified inside the BREAKPOINT block.

\section{NINEML Components}


The \Dynamics block represents the \emph{internal} mechanisms
governing the behaviour of the component. These dynamics are based on ordinary differential equations (ODE) but may contain non-linear transitions between
different ODE regimes. The regime graph (e.g. \ref{fig:simple_regime_graph}) must contain at least one \Regime element, and contain no regime islands. At any given time, a component will be in a single regime, and can change which regime it is in through transitions.

\note{\Alias objects are defined in Dynamics blocks, \emph{not} \Regime blocks. This means that aliases are the same across all regimes.}


\subsection{KineticState}
\label{sec:KineticState}

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{KineticState Structure}}}\\
    \toprule
    \em{Attribute name} & \em{Type/Format} & \em{Required} \\
    \midrule
    name & \identifier & yes\\
    dimension & \Dimension{}@name & yes\\
    \bottomrule
  \end{edtable}
\end{table}

The internal state of a component is defined by a set of state variables
 -- variables that can change either continuously or discontinuously as a
function of time.

The value of a \KineticState can change in two ways:
\begin{quote}
\begin{itemize}
\item continuously through \TimeDerivative elements (in {\Regime} elements),
which define how the {\KineticState} evolves over time, e.g.
$dX/dt=1-X$.
\item discretely through \StateAssignment (in \OnCondition or \OnEvent transition elements),
which make discrete changes to a \KineticState value, e.g. $X = X + 1$.
\end{itemize}
\end{quote}

Only continuous changes are relevant to NineML KINETICs scheme.



\subsection{TimeDerivative}
\label{sec:TimeDerivative}

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{TimeDerivative Structure}}}\\
    \toprule
    \em{Attribute name} & \em{Type/Format} & \em{Required} \\
    \midrule
    variable & \KineticState{}@name & yes\\
    \midrule
    \em{Element type} & \em{Multiplicity} & \em{Required} \\
    \midrule
    \MathInline & singleton & yes \\ 
    \bottomrule
  \end{edtable}
\end{table}

\TimeDerivative elements contain a mathematical expression for the right-hand side of the ODE
\begin{equation}
\frac{\mathrm{d} variable}{\mathrm{d} t} = expression
\end{equation}
which can contain of references to any combination of \KineticState, \Parameter, \AnalogReceivePort, \AnalogReducePort and \Alias. Therefore, only one \TimeDerivative element is allowed per \KineticState per \Regime. If a {\TimeDerivative} for a \KineticState is not defined in a \Regime, it is assumed to be zero.

\subsubsection{Variable attribute}
Each \TimeDerivative requires a \textit{variable} attribute. This should refer to the name of a \KineticState in the \ComponentClass. Only one \TimeDerivative is allowed per \textit{variable} in each \Regime.




\subsection{Kinetic}
%\label{sec:ComponentClass}

Maps onto a \Dynamics block. A reaction is a process that facilitates the transition of a molecular entity between states. A kinetic scheme usually contains a multiple number of states, and a multiple number of reactions. Within the Kinetics block the user of the Kinetics block can instantiate any number of KineticStates, and Reactions. 
%Ie flattening of the tree is facilitated by mapping onto a dynamics block.

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{Kinetic Structure}}}\\
    \toprule
    \em{Element type} & \em{Multiplicity} & \em{Required} \\
    \midrule
    \KineticState & set & yes \\
    \Reaction & set & yes \\
    \Constraint & set & no \\
    \Alias & set & no \\
    \Constant & set & no \\
    \bottomrule
  \end{edtable}
\end{table}


\subsection{KineticState}
\label{sec:KineticState}

Each Kinetic scheme is able to accommodate an arbitrary number of states. 

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{Kinetic Structure}}}\\
    \toprule
    \em{Attribute name} & \em{Type/Format} & \em{Required} \\
    \midrule
    name & \identifier & yes\\
    \bottomrule
  \end{edtable}
\end{table}

\subsubsection{Name attribute}


\subsection{Reaction}
\label{sec:Reaction}
Because the number of possible ion channel states is variable the number of reactions between states must also be variable, however it is expected that the number of possible reactions should be at least one less than the number of possible states. Reactions have a from and a to attribute, which describes which state variable, they are moving from and which state varible the moving to.

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{Reaction Structure}}}\\
    \toprule
    \em{Attribute name} & \em{Type/Format} & \em{Required} \\
    \midrule
    from & \KineticState{}@name & yes\\
    to & \KineticState{}@name & yes\\
    \midrule
    \em{Element type} & \em{Multiplicity} & \em{Required} \\
    \midrule
    \ForwardRate & singleton & yes\\
    \ReverseRate & singleton & yes\\
    \bottomrule
  \end{edtable}
\end{table}

\subsubsection{From attribute}

Attribute name Type/Format Required
name identifier yes

\subsubsection{To attribute}

Attribute name Type/Format Required
name identifier yes


\subsection{ForwardRate}
\label{sec:ForwardRate}
The forward rate describes the rate of change of a molecular entity from one state to another  an example might be ion channels as they move from a closed state to an open state. At most one forward rate equation and one reverse rate per Reaction.  
\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{ForwardRate Structure}}}\\
    \toprule
    \em{Element type} & \em{Multiplicity} & \em{Required} \\
    \midrule
    \MathInline & singleton & yes\\
    \bottomrule
  \end{edtable}
\end{table}


\subsection{ReverseRate}
\label{sec:ReverseRate}
The reverse rate describes that rate of change for the reverse process described in ForwardRate.

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{ReverseRate Structure}}}\\
    \toprule
    \em{Element type} & \em{Multiplicity} & \em{Required} \\
    \midrule
    \MathInline & singleton & yes\\
    \bottomrule
  \end{edtable}
\end{table}


\subsection{Constraint}
\label{sec:Constraint}

The right hand side of the kinetics equation must be stated in a format where left hand side is equal to unity. If a kinetic equation is expressed with a non unity right hand side they may require a basic manipulation. At most the user can specify only one constraint equation per Kinetic Component.

The concept of conservation of matter is central in calculating the fraction molecular entities that occupy a particular state. This is because molecular transition out of one state equals molecular transition into another state.

\begin{table}[H]
  \begin{edtable}{tabular}{llr}
    \toprule
    \multicolumn{3}{c}{\parbox{0.55\linewidth}{\center\textbf{Constraint Structure}}}\\
    \toprule
    \em{Element type} & \em{Multiplicity} & \em{Required} \\
    \midrule
    \MathInline & singleton & yes\\
    \bottomrule
  \end{edtable}
\end{table}


\subsection{Example use of kinetic scheme}.


\begin{lstlisting}[label=code:xmliaf2]
<?xml version='1.0' encoding='UTF-8'?>
<NineML xmlns="http://nineml.net/9ML/2.0">
  <ComponentClass name="Kinetic">
    <KineticState name C2 > 
      <to> O </to>
      <from> C1 </from>
    </KineticState>  
    <Reaction>
      <Alias name="K1">
	    <mathinline>  K1=exp(k2*(d2-v)-k1*(d1-v)) </MathInline> 
  	  </Alias>

	  <ForwardRate>kf1=k1/(tau1(v)*(1+K1))</ForwardRate>
		 </mathinline> 
      </ForwardRate>
      
      
      
    </Reaction>
  
    <KineticState name = O > 
      <to> C2 </to>
      <from> C2  </from>
    </KineticState>  
    <Reaction>
      <ForwardRate> <mathinline>  </mathinline> </ForwardRate>
      <ReverseRate> <mathinline>  </mathinline> </ReverseRate>
    </Reaction>
    
    <KineticState name = C1 > 
      <to> C2 </to>
      <from> C2  </from>
    </KineticState>  
    <Reaction>
      <ForwardRate> <mathinline>  </mathinline> </ForwardRate>
      <ReverseRate> <mathinline>  </mathinline> </ReverseRate>
    </Reaction>

    
    <constraint> c1+c2+o=1    </constraint>
  <ComponentClass>  
      


      <Conserve> <mathinline> C1+C2+O=1 </mathinline> </Conserve>
	  	
	  

\end{lstlisting}

\begin{lstlisting}[label=code:xmliaf2]
<?xml version='1.0' encoding='UTF-8'?>
<NineML xmlns="http://nineml.net/9ML/2.0">
  <ComponentClass name="KineticMechanism">
	<Parameter name="v" dimension="voltage"/>
    <Parameter dimension="dimensionless" name="C1"/>
    <Parameter dimension="dimensionless" name="C2"/>
    <Parameter dimension="dimensionless" name="O"/>
    <Dynamics>
      <KineticState dimension="voltage" name v/> 
      <KineticState dimension="dimensionless" name="C1"/>
      <KineticState dimension="dimensionless" name="C2"/>
      <KineticState dimension="dimensionless" name="O"/>




	  <TimeDerivative variable="C1">
	  	<MathInline>( kf1*C1+kf2*)</MathInline>
 	  </TimeDerivative>

    
	 
	  <KineticEquation from='C1 to C2'>
	 	
	 	<AnalogRecievePort> v </AnalogRecievePort>

	 	<Conserve> 
	 	  C1+C2+O=1  
	 	</Conserve>    
    	
    	<Alias name="K1">
	 	  <MathInline> K1=exp(k2*(d2-v)-k1*(d1-v)) </MathInline> 
  	    </Alias>

	  	<ForwardRate>kf1=k1/(tau1(v)*(1+K1))</ForwardRate>
		
		
		<AnalogSendPort></AnalogSendPort>
	  </KineticEquation>

	  <KineticEquation from='C2 to O'>
	  	<Conserve>  
	  	  C1+C2+O=1  
	  	</Conserve>
	  	
		<Alias name="K2">
	 	  <MathInline> K2=exp(-k2*(d2-v))  </MathInline>
	 	</Alias>
	 	<ForwardRate>kf2=k2/(tau2(v)*(1+K2))</ForwardRate>

	  	<ForwardRate></ForwardRate>
		<ReverseRate></ReverseRate>
		<AnalogSendPort></AnalogSendPort>
		<AnalogRecievePort></AnalogRecievePort>
	 </KineticEquation>


     <KineticEquation from='0 to C2'>
	  	<Conserve>  C1+C2+O=1  </Conserve>
	  	
		<Alias name="K2">
	 	  <MathInline> K2=exp(-k2*(d2-v))  </MathInline>
	 	</Alias>
		<ReverseRate>kb1=1/(tau1(v)*(1+K1))</ReverseRate>

	  	<ForwardRate></ForwardRate>
		<ReverseRate></ReverseRate>
		<AnalogSendPort></AnalogSendPort>
		<AnalogRecievePort></AnalogRecievePort>
	 </KineticEquation>


     <KineticEquation from='C2' to C1>
	   <Conserve>  C1+C2+O=1  </Conserve>
	  	
	   <Alias name="K2">
	 	  <MathInline> K2=exp(-k2*(d2-v))  </MathInline>
	   </Alias>
		<ReverseRate>kb2=1/(tau2(v)*(1+K2))</ReverseRate>

	   <ForwardRate></ForwardRate>
	   <ReverseRate></ReverseRate>
	   <AnalogSendPort></AnalogSendPort>
	   <AnalogRecievePort></AnalogRecievePort>


	 <Function>
       rates
	 </Function>

	 </KineticEquation>

     <KineticEq from='C2' to C1>
       rates(v) 
       c1   &lt; - &gt; c2 (kf1,kb1) #forwards1, backwards1
       c2   &lt; - &gt; o  (kf2,kb2) #forwards, backwards2 
       
	   <Conserve>  C1+C2+O=1  </Conserve>
	  	
	   <Alias name="K2">
	 	  <MathInline> K2=exp(-k2*(d2-v))  </MathInline>
	   </Alias>
		<ReverseRate>kb2=1/(tau2(v)*(1+K2))</ReverseRate>

	   <ForwardRate></ForwardRate>
	   <ReverseRate></ReverseRate>
	   <AnalogSendPort></AnalogSendPort>
	   <AnalogRecievePort></AnalogRecievePort>
	 </KineticEquation>

	  
  </ComponentClass>
  
\end{lstlisting}[label=code:xmliaf2]


\clearpage
\bibliography{specification}

% -----------------------------------------------------------------------------
% End of document
% -----------------------------------------------------------------------------

\end{document}
